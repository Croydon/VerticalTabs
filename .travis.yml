sudo: false
dist: trusty
language: node_js
# Always run the latest Node.js version

notifications:
  email:
    on_success: change
    on_failure: change

git:
  depth: 5

node_js:
  - "node"

env:
  - RUN=addons-linter
  - RUN=eslint

before_script:
  - set -e
  - npm install ${RUN} --global
  - ${RUN} --version
  - ${RUN} --help

script:
  - ${RUN} .

jobs:
  include:
    - stage: Deploy
      before_script:
        - set -e
        - if [[ -z "$TRAVIS_TAG" ]] && [[ "$(git diff --name-only ${TRAVIS_COMMIT}^ -- manifest.json)" == "" ]]; then exit 0; fi;
        - npm install -g web-ext
        - if [[ -z "$TRAVIS_TAG" ]]; then sed --in-place 's/verticaltabsreloaded/vtrbeta/' manifest.json; fi;
        - if [[ -z "$TRAVIS_TAG" ]]; then sed --in-place 's/Vertical Tabs Reloaded/VTR (DEVELOPER VERSION)/' manifest.json; fi;
      script:
        - web-ext --version
        - web-ext sign --api-key=${AMO_API_USER} --api-secret=${AMO_API_SECRET}
